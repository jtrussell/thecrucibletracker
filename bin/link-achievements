#!/usr/bin/env node
const fs = require('fs');

let output = `// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.

module.exports = [
`;

const files = [];
const folder = './worker/achievements/scripts';

fs.readdirSync(folder).forEach((file) => {
  if (file === '.DS_Store') return;
  files.push(file);
});

files.forEach((file) => {
  output += `\n  require('./scripts/${file}'),`;
});

output += '\n];';

fs.writeFileSync('./worker/achievements/achievement-scripts.js', output);

const existingMetadata = require('../web/achievements/metadata.js');

const metadata = {};
files.forEach((file) => {
  const script = require(`../worker/achievements/scripts/${file}`);
  if (existingMetadata[script.id]) {
    return;
  }
  if (!script.id) {
    return;
  }
  metadata[script.id] = {
    title: script.id.replace(/-/g, ' '),
    icon: '<s3 url>/narp.png', // TODO
    iconMargin: '-10px 0 0 -50px',
    iconWidth: '150px',
  };
});
